import { useState, useCallback, useRef } from "react";
import { ArgsTable, Canvas, Meta, Story } from "@storybook/addon-docs";
import { ComponentRules, createStoryMetaSettings, RelatedComponents, Tip, UsageGuidelines } from "../../../storybook";
import Button from "../../Button/Button";
import ModalContent from "../ModalContent/ModalContent";
import ModalFooter from "../ModalFooter/ModalFooter";
import ModalHeader from "../ModalHeader/ModalHeader";
import ModalButtons from "../ModalButtons/ModalButtons";
import {
  ATTENTION_BOX,
  TOAST,
  TOOLTIP
} from "../../../storybook/components/related-components/component-description-map";
import Settings from "../../../components/Icon/Icons/components/Settings";
import Modal from "../Modal";
import { createHelperOpenModalButton, useModalHelper } from "./helpers";
import "./Modal.stories.scss";

export const metaSettings = createStoryMetaSettings({
  component: Modal,
  enumPropNamesArray: ["width"], // List enum props here
  iconPropNamesArray: [] // List props that are typed as icons here
});

export const modalTemplate = ({ onClose, ...modalProps }) => {
  // For some reason storybook replace onClose with mock function as part of the template props so in purpose not pass it forward
  // Control if modal is display or hidden
  const [show, setShow] = useState(false);
  const openModalButtonRef = useRef(null);
  const closeModal = useCallback(() => {
    debugger;
    setShow(false);
  }, []);
  // This is internal helper method for creating basic button which change the show state to true in order to display the modal
  // This method is not part of our external API and not required for creating function modal component
  const openModalButton = createHelperOpenModalButton({ title: modalProps.title, setShow, openModalButtonRef });
  return (
    <div>
      {openModalButton}
      <Modal
        id={"story-book-modal"}
        title={"Modal title"}
        triggerElement={openModalButtonRef.current}
        // is modal show or hidden
        show={show}
        // set show state to close
        onClose={closeModal}
        closeButtonAriaLabel={"close"}
        width={Modal.width.DEFAULT}
        {...modalProps}
      >
        <ModalContent>
          <p className="modal-content">Modal content goes here</p>
        </ModalContent>
        <ModalFooter>
          <ModalButtons cancelCallback={closeModal} confirmCallback={closeModal} />
        </ModalFooter>
      </Modal>
    </div>
  );
};

<Meta
  title="Feedback/Modal"
  component={Modal}
  subcomponents={{ ModalHeader, ModalContent, ModalFooter, ModalButtons }}
  argTypes={metaSettings.argTypes}
  decorators={metaSettings.decorators}
/>

<!--- Component documentation -->

# Modal

- [Overview](#overview)
- [Props](#props)
- [Usage](#usage)
- [Variants](#variants)
- [Do’s and don’ts](#dos-and-donts)
- [Use cases and examples](#use-cases-and-examples)
- [Related components](#related-components)
- [Feedback](#feedback)

## Overview

Modal allows the user to focus on one task or a piece of information, by popping-up and blocking the page content until the modal task is completed, or until the user dismisses the action.

<Canvas>
  <Story name="Overview">{modalTemplate.bind({})}</Story>
</Canvas>

## Props

<ArgsTable story="Overview" />

## Usage

<UsageGuidelines
  guidelines={[
    "Modals appear centered on the page, with a visible backdrop dimming the rest of the page for focus.",
    "Modals height is dynamic according to its content.",
    "All modals must have a title and a close button",
    " By default, Modal will be closed by: clicking outside, the ESC key and the closing buttons"
  ]}
/>

<Tip>
  Set `alertDialog` to `true` in order to allow closing the modal only by the close buttons and not by ESC or by
  clicking outside. Learn more
</Tip>
<Tip>Use modal for short and non-frequent tasks. For common tasks consider using the main flow.</Tip>

## Variants

### Sizes

<Canvas>
  <Story name="Width variants - Normal" args={{ title: "Default", width: Modal.width.DEFAULT }}>
    {modalTemplate.bind({})}
  </Story>
  <Story name="Width variants - Full" args={{ title: "Full size", width: Modal.width.FULL_WIDTH }}>
    {modalTemplate.bind({})}
  </Story>
</Canvas>

### Modal header with an icon

Use the ModalHeader component to display a Header with an icon

<Canvas>
  <Story name="Modal with icon">
    {() => {
      // Control if modal is display or hidden
      const [show, setShow] = useState(false);
      const openModalButtonRef = useRef(null);
      const closeModal = useCallback(() => {
        debugger;
        setShow(false);
      }, []);
      // This is internal helper method for creating basic button which change the show state to true in order to display the modal
      // This method is not part of our external API and not required for creating function modal component
      const openModalButton = createHelperOpenModalButton({
        title: "Modal header with an Icon",
        setShow,
        openModalButtonRef
      });
      return (
        <div>
          {openModalButton}
          <Modal
            id={"story-book-modal"}
            title="Modal header with an Icon"
            triggerElement={openModalButtonRef.current}
            // is modal show or hidden
            show={show}
            // set show state to close
            onClose={closeModal}
            closeButtonAriaLabel={"close"}
            width={Modal.width.DEFAULT}
          >
            <ModalHeader title={"Modal Title"} icon={Settings} />
            <ModalContent>
              <p className="modal-content">Modal content goes here</p>
            </ModalContent>
            <ModalFooter>
              <ModalButtons cancelCallback={closeModal} confirmCallback={closeModal} />
            </ModalFooter>
          </Modal>
        </div>
      );
    }}
  </Story>
</Canvas>

### Alert Modal (Modal)

Use this variant in case of sensitive or important messages, and in modals that requires data from the user, such as forms.
The Alert modal will not be closed by clicking outside the modal or by the ESC key. It will be closed only by the close button and the footer buttons.

<Canvas>
  <Story name="Alert Modal" args={{ title: "Alert dialog", alertDialog: true }}>
    {modalTemplate.bind({})}
  </Story>
</Canvas>

## Do’s and Don’ts

<ComponentRules
  rules={[
    {
      positive: {
        component: <div></div>,
        description: "Allow the user to easly close the modal by CTA and a close button.."
      },
      negative: {
        component: <div></div>,
        description: "Don’t align the footer buttons to the left."
      }
    }
  ]}
/>

## Related components

<RelatedComponents componentsNames={[TOOLTIP, ATTENTION_BOX, TOAST]} />
