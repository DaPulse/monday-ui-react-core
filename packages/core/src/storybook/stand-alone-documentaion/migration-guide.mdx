import { Meta, Markdown, Source } from "@storybook/blocks";
import { Link, Tip } from "vibe-storybook-components";
import { EDITABLE_HEADING, HEADING, TEXT } from "../components/related-components/component-description-map";
import { Prism as SyntaxHighlighter } from "react-syntax-highlighter";
import { dark } from "react-syntax-highlighter/dist/esm/styles/prism";
import { DiffCodeBlock } from "../../storybook/components/DiffCodeBlock";
import propsGif from "./assets/props.gif";

<Meta title="Migration Guide" />

# Vibe 3 Migration Guide

<div class="sb-unstyled" style={{ lineHeight: "1.8" }} >

- [Intro](#intro)
- [Automatic migration ü§ñ](#automatic-migration-)
- [New features ‚ú®](#new-features-)
- [Breaking changes üö®](#breaking-changes-)
  - [General](#general)
  - [Typography](#typography)
  - [Components](#components)
  - [Hooks](#hooks)
  - [Colors](#colors)
  - [Icons](#icons)
- [FAQ ‚ùì](#faq-)
- [Help & Feedback üôè](#help--feedback-)

## Intro

Vibe 3 is a major update to the Vibe design system, introducing several new features, enhancements, and breaking changes. This guide will walk you through the changes to help you transition smoothly from v2 to v3.

<Tip title="Migration from v1 to v2" emoji={false}>
  To migrate from v1 to v2, please refer to the [Vibe 2 migration
  guide](https://github.com/mondaycom/vibe/tree/master/docs/vibe2-migration-guide.md)
</Tip>

## Automatic migration ü§ñ

To help you migrate your existing codebase to Vibe 3, we have created an automatic migration script (codemod) that will update your codebase to the new APIs and components. To run the migration script, use the following command:

```bash
npx @vibe/codemod v3-migration path/to/your/files
```

Please note that most of the changes are covered by the migration script, but some manual changes may still be required as some changes require manual intervention (whether regarding style, UX, or behavior).

**It is highly recommended to review the changes made by the script and test your application thoroughly to ensure everything works as expected.**

<Tip title="Be aware of uncovered changes" emoji="üö©">
  Changes that are not covered by the automatic migration are marked with a üö© in the [Breaking
  changes](#breaking-changes-) section below.
</Tip>

## New features ‚ú®

**Reduced bundle size**

By removing CommonJS support and optimizing the library exports, the bundle size has been reduced by [fill in] for better performance

{/* bundle phobia image? */}

**New Typography System**

New and improved <StorybookLink page="Text/Heading">Heading</StorybookLink>, <StorybookLink page="Inputs/EditableHeading">EditableHeading</StorybookLink>, and <StorybookLink page="Inputs/Search">Search</StorybookLink> components

**Enhanced Typescript Support**

All components' types and interfaces are exported for better type-safe compositions. For example:

```tsx
import { Button, ButtonProps, ButtonType } from "monday-ui-react-core";
```

**Improved prop type-checking**

Now you can use type-safe strings instead of static enums for props, providing a better developer experience:

```tsx
// Before
<Button kind={Button.kinds.PRIMARY} size={Button.sizes.SMALL}>click</Button>

// After
<Button kind="primary" size="small">click</Button>
```

See Intellisense in action in your favorite IDE:

<img src={propsGif} width="300" alt="Using props values instead of enums" />

You can still use the static properties, although not recommended, as they are likely to be deprecated in the future.

{/* Package rename */}
{/* Layer provider */}

## Breaking changes üö®

Several breaking changes have been made to optimize and streamline the library. These changes include the removal of deprecated components, updates to component APIs, and overall enhancements.

The breaking changes are categorized as follows:

1. [General](#general)
2. [Typography](#typography)
3. [Components](#components)
4. [Hooks](#hooks)
5. [Colors](#colors)
6. [Icons](#icons)

**It's essential to review these changes carefully to ensure your application continues to function correctly and efficiently:**

### General

- **CommonJS support has been removed** to modernize the library, reduce complexity, and ensure better compatibility with modern JavaScript tooling and ESM (ECMAScript Modules) standards. This change helps improve performance and aligns with current best practices in JavaScript development.
- The `monday-ui-react-core/next` entry **was removed** - components that were imported from it are now imported from `monday-ui-react-core`.
- The `monday-ui-react-core/types` entry **was removed**, all types and interfaces are now exported from `monday-ui-react-core`.
- The `monday-ui-react-core/storybookComponents` entry **was removed**, use the [vibe-storybook-components](https://www.npmjs.com/package/vibe-storybook-components) package instead.
- The `monday-ui-react-core/dist/main.css` **was removed**, use `monday-ui-react-core/tokens` instead to load all relevant CSS tokens:

<DiffCodeBlock
  code={`- import "monday-ui-react-core/dist/main.css";
+ import "monday-ui-react-core/tokens";
`}
/>

### Typography

The typography system has been updated to provide a more consistent and accessible experience. The new typography system includes a set of predefined text styles and sizes that can be easily applied to components.

- Use the <StorybookLink page="Text/Text">Text</StorybookLink> component for paragraphs, labels, and texts up to
  16px. It includes 3 variants: <code>text1</code>, <code>text2</code> and <code>text3</code>. Each variant has a
  fixed size and three different weights.

- Use the <StorybookLink page="Text/Heading">Heading</StorybookLink> component the for titles and text from 18px and
  up. It includes 3 variants: <code>h1</code>, <code>h2</code> and <code>h3</code>. Each of these variant is mapped
  to an <code>h1</code>, <code>h2</code>, <code>h3</code> element accordingly.

To replace old typography usages:

- **H1 Main heading** (`--font-h1`) ‚Üí **Heading/H1/normal**
- **H2 Secondary heading** (`--font-h2`) ‚Üí **Heading/H2/bold**
- **H3 Tertiary heading** (`--font-h3`) ‚Üí **Heading/H2/light**
- **H4 Fourth heading** (`--font-h4`) ‚Üí **Heading/H3/bold**
- **H5 Paragraph** (`--font-h5`) ‚Üí **Text/text1/bold**
- **H6 UI text** (`--font-general-label`) ‚Üí **Text/text2/normal**
- **Medium Text** (`--font-subtext`) ‚Üí **Text/text2/normal**
- **P Paragraph text** (`--font-paragraph`) ‚Üí **Text/text1/normal**
- **Medium text link** (`--font-general-label`, `--link-color`) ‚Üí **Text/text2/normal**

For more information, refer to the <StorybookLink page="Foundations/Typography">Typography</StorybookLink> docs.

### Components

The following components have been **removed** and are no longer available:

- `Input` - use <StorybookLink page="Inputs/Heading">TextField</StorybookLink> instead
- `EditableInput` - use <StorybookLink page="Inputs/EditableText">EditableText</StorybookLink> instead
- `SearchComponent` - use <StorybookLink page="Inputs/Search">Search</StorybookLink> instead
- `ResponsiveList` - use <StorybookLink page="Hooks/useIsOverflowing">useIsOverflowing</StorybookLink> hook instead, to show/hide content based on overflow

These components were **rewritten from scracth** with new API and style, offering better accessiblity and usability:

- <StorybookLink page="Text/Heading">Heading</StorybookLink>
- <StorybookLink page="Inputs/EditableHeading">EditableHeading</StorybookLink>
- <StorybookLink page="Inputs/Search">Search</StorybookLink>

The following components have breaking changes to their API, behavior, or style, as detailed below:

**AttentionBox**

- The `componentClassName` prop has been removed, use `className` instead

**Avatar**

- The `isSquare` prop has been removed, use `square` instead
- The `isDisabled` prop has been removed, use `disabled` instead

**AvatarGroup**

- The `removePadding` prop has been removed, and the component no longer gets a padding bottom

**Box**

- The `border` prop type has been changed from string to boolean, and the so `Box.borders` static prop has been removed:

<DiffCodeBlock
  code={`- <Box border={Box.borders.DEFAULT}>
+ <Box border>
`}
/>

**BreadcrumbItem**

- The `isDisabled` prop has been removed, use `disabled` instead

**Button**

- The `dataTestId` prop has been removed, use `data-testid` instead
- The `children` prop is now mandatory
- The `sm`, `md`, `lg` sizes were removed, use `small`, `medium`, `large` respectively:

<DiffCodeBlock
  code={`- <Button size="sm">
+ <Button size="small">
`}
/>

**ButtonGroup**

- The `componentClassName` prop has been removed, use `className` instead

**Checkbox**

- The `componentClassName` prop has been removed, use `className` instead

**Chips**

- The `dataTestId` prop has been removed, use `data-testid` instead
- The `DARK_INDIGO` and `BLACKISH` colors were removed from the `color` prop
- The `clickable` and `isClickable` props were removed, use `onClick` instead, to get clickable behavior and style:

<DiffCodeBlock
  code={`- <Chips clickable>
+ <Chips onClick={() => {}}>
`}
/>

**Clickable**

- The `dataTestId` prop has been removed, use `data-testid` instead

**Counter**

- `wrapperClassName` -> `className`
- The `sm`, `md`, `lg` sizes were removed, use `small`, `medium`, `large` respectively:

<DiffCodeBlock
  code={`- <Counter size="sm">
+ <Counter size="small">
`}
/>

**Dialog**

- The `shoudlCallbackOnMount` prop has been removed, use `shouldCallbackOnMount` instead

**DialogContentContainer**

- The "medium" `size` now has an increased padding, correcting a previous sizing issue where "medium" and "small" had identical paddings. As a result, "small" is now the default size. If no size was specified there's no action required.

**Divider**

- The `classname` prop has been removed, use `className` instead

**Flex**

- The `Flex.gaps.NONE` property has been removed, to specify no gap simply omit the `gap` prop

**Dropdown**

- The `Dropdown.size` property was removed, use `Dropdown.sizes` instead
- The `xxs`, `xs` sizes were acting as the `small` size and therefore removed. Use `small` instead
- The `withReadOnlyStyle` prop was removed, new readonly style will be applied automatically when using the `readOnly` prop

**Icon**

- The `clickable`, `onClick` props were removed, use `<IconButton>` for clickable icons:

<DiffCodeBlock
  code={`- <Icon icon={Heart} clickable onClick={() => {}}>
+ <IconButton icon={Heart} onClick={() => {}}>
`}
/>

**IconButton**

- The `dataTestId` prop has been removed, use `data-testid` instead

**Label**

- The `wrapperClassName` prop has been removed, use `className` instead
- The "Spin In" animation was removed, and so the `isAnimationDisabled` prop has been removed

**Link**

- The `componentClassName` prop has been removed, use `className` instead
- The static `Link.target` propery was removed, use `Link.targets` instead

**Loader**

- The `svgClassName` prop has been removed, use `className` instead

**Menu**

- The `classname` prop has been removed, use `className` instead

**MenuDivider**

- The `classname` prop has been removed, use `className` instead

**MenuItem**

- The `classname` prop has been removed, use `className` instead
- The provided tooltip (when the text is overflowing) now wraps the entire element so non-block layout given to the `title` prop may break üö©

**MenuItemButton**

- The `classname` prop has been removed, use `className` instead

**MenuTitle**

- The `classname` prop has been removed, use `className` instead

**MenuButton**

- The `componentClassName` prop has been removed, use `className` instead
- The `closeDialogOnContentClick` prop has been removed, use `closeMenuOnItemClick` instead
- The `disabledReason` prop has been removed, use `tooltipContent` instead

**Modal**

- The `hideCloseButton` has been removed since Modals should always have a close button
- The `unmountOnClose` prop default value changes to "true", meaning the Modal will not render when `show` is "false". To disable this behavior set `unmountOnClose` to "false"

**ModalHeader**

- The `hideCloseButton` has been removed since Modals should always have a close button

**RadioButton**

- The `componentClassName` prop has been removed, use `className` instead

**SplitButton**

- The `data-testId` prop will no longer be applied to the internal elements, only the root element

**Steps**

- The `isOnPrimary` prop was removed, use `color="primary` instead:

<DiffCodeBlock
  code={`- <Steps isOnPrimary>
+ <Steps color="primary">
`}
/>

**Tabs**

- Browser's default margin/padding for ul, li elements was reset

**TabList**

- The component no longer gets a padding bottom, and so the `noPadding` prop was removed

**TabPanels**

- TabPanels will render only the active tab instead of rendering all the panels, and so the `renderOnlyActiveTab` was removed

**TextField**

- The `dataTestId` prop has been removed, use `data-testid` instead
- The `iconsNames` prop no longer accepts the `layout` property
- Providing the `required` prop will now show a red asterisk, implying that the field is mandatory, and so the `requiredAsterisk` prop was removed
- The `withReadOnlyStyle` prop was removed, new readonly style will be applied automatically when using the `readOnly` prop
- The `sm`, `md`, `lg` sizes were removed, use `small`, `medium`, `large` respectively:

**ThemeProvider**

- The `theme` has been removed, use `themeConfig` instead

**Tipseen**

- The `content` prop is now mandatory
- The default `color` has changed from 'primary' to 'inverted'. To keep the previous color, set the `color` prop to 'primary'
- The `isCloseButtonHidden` prop has been removed, use `hideCloseButton` instead
- The `showDelay` prop's default value has changed to 100
- The `justify` prop was removed, and so the `Tipseen.justifyTypes` static property was removed as well

**TipseenContent**

- The `isDismissHidden` prop has been removed, use `hideDismiss` instead
- The `isSubmitHidden` prop has been removed, use `hideSubmit` instead
- The `submitButtonProps`, `dismissButtonProps` props were removed, use `submitButtonText` and `dismissButtonText` to change the buttons' text

**Toggle**

- The `componentClassName` prop has been removed, use `className` instead
- The `isDisabled` prop has been removed, use `disabled` instead

**Tooltip**

- The `paddingSize`, `justify`, and `arrowPosition` props were removed. Accordingly the `Tooltip.paddingSizes`, `Tooltip.justifyTypes`, and `Tooltip.arrowPositions` static properties were removed as well
- The `themes` prop can now accept only "dark" or "primary"
- The `position` prop can now accept only "top, right, bottom, left"
- The `showOnDialogEnter` props's default value has changed to true, now the tooltip will remain open be default when hovering over it
- The `hideDelay` props's default value changed to 100
- The `addKeyboardHideShowTriggersByDefault` default changed to true, making it accessible with keyboard navigation
- The `withMaxWidth` prop was removed, the tooltip's max-width is now set to 240px
- Tooltip's `content` is now wrapped in another div, meaning that non-block layouts inside the tooltip may break üö©

**ColorPicker**

- The static `ColorPicker.COLOR_STYLES` property has been removed, use `ColorPicker.colorStyles` instead

**ColorPickerContent**

- The static `ColorPickerContent.COLOR_STYLES` property has been removed, use `ColorPickerContent.colorStyles` instead

### Hooks

**useClickableProps**

- The `dataTestId` prop has been removed, use `data-testid` instead

### Colors

- The `--shareable-color` and `--private-color` CSS variables were removed for all themes
- The `color-warning`, `color-warning-hover`, `color-warning-select`, `color-warning-select-hover` colors were removed from the `colors.json` file (in `monday-ui-style` package), use `warning-color-*` respectively

### Icons

- The `Upgrade` icon has been removed, and the `Featured` icon has been renamed to `Upgrade`:

<DiffCodeBlock
  code={`- <Icon icon={Featured}>
+ <Icon icon={Upgrade}>
`}
/>

## FAQ ‚ùì

**What is the best way to migrate to Vibe 3?**

It is recommended using the automatic migration script to update your codebase to the new APIs and components. After running the script, review the changes and test your application thoroughly to ensure everything works as expected.

**Are there any manual changes required after running the migration script?**

While the migration script covers most changes, some manual changes may still be required where style, UX, or behavior changes are involved.

**Do I need to stop using static properties (e.g. `Button.kinds.PRIMARY`) in my code?**

You can still use static properties, but it is recommended to use type-safe strings instead. Static properties are likely to be deprecated in the future.

**I have already been using Heading, EditableHeading, Search from `/next`, do I need to change anything?**

If you have been using these components from `/next`, you will only need to update your imports to use the components from the main entry (`monday-ui-react-core`).

**Are there any known issues or limitations with Vibe 3?**

While we have made every effort to ensure Vibe 3 is stable and reliable, there may be some known issues or limitations. If you encounter any problems, please create an [issue](https://github.com/mondaycom/vibe/issues/new/choose).

**What if I don't want to migrate to Vibe 3?**

While we recommend migrating to Vibe 3 to take advantage of the new features and improvements, you can continue using Vibe 2. However, please note that Vibe 2 will no longer recieve any new features or updates aside from critical bug fixes, and will reach EOL upon the next major version (Vibe 4) release.

{/* add about packages renaming */}

</div>

## Help & Feedback üôè

If you have any questions, feedback, or need help, please don't hesitate to reach out to us. You can provide [feedback](https://github.com/mondaycom/vibe/discussions) or [report issues](https://github.com/mondaycom/vibe/issues/new/choose) in the [Vibe repository](https://github.com/mondaycom/vibe).

We also welcome contributions and suggestions to help make Vibe better. If you are interested in contributing to the project, please read our <StorybookLink page="Contributing">Contribution guidelines</StorybookLink>.
