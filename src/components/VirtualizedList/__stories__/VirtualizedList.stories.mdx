import { useCallback, useMemo, useState } from "react";
import VirtualizedList from "../VirtualizedList";
import Button from "../../Button/Button";
import { ArgsTable, Story, Canvas, Meta } from "@storybook/addon-docs";
import { createComponentTemplate } from "../../../storybook/functions/create-component-story";
import { generateItems, itemRenderer } from "./virtualizedList.components";

<Meta title="Navigation/VirtualizedList" component={VirtualizedList} />

<!--- Component template -->

export const virtualizedListTemplate = args => {
  const [scrollToId, setScrollToId] = useState(null);
  const [lastScrolledId, setLastScrolledId] = useState(null);
  const [scrollToDisabled, setScrollToDisabled] = useState(false);
  const [nextScrollToId, setNextScrollToId] = useState(args.itemsCount - 1);
  const items = useMemo(() => {
    return generateItems(30, args.itemsCount);
  }, []);
  const onClickToScroll = useCallback(() => {
    setScrollToId(nextScrollToId);
    setLastScrolledId("");
    setScrollToDisabled(true);
  }, [setScrollToId, setScrollToDisabled, items, nextScrollToId]);
  const onScrollToFinished = useCallback(() => {
    setLastScrolledId(nextScrollToId);
    setScrollToId(null);
    setNextScrollToId(Math.round(Math.random() * items.length));
    setScrollToDisabled(false);
  }, [nextScrollToId, items, setNextScrollToId, setLastScrolledId]);
  return (
    <div
      style={{
        width: 430,
        height: 300,
        overflow: "hidden",
        display: "flex",
        alignItems: "center"
      }}
    >
      <div style={{ width: 200, height: "100%" }}>
        <VirtualizedList
          id="Knobs"
          items={items}
          itemRenderer={itemRenderer}
          onScrollToFinished={onScrollToFinished}
          scrollToId={scrollToId}
        />
      </div>
      <div style={{ display: "flex", flexDirection: "column", alignItems: "center" }}>
        <Button
          size={Button.sizes.MEDIUM}
          kind={Button.kinds.PRIMARY}
          onClick={onClickToScroll}
          disabled={scrollToDisabled}
        >
          {`Scroll to Item ${nextScrollToId}`}
        </Button>
        <div style={{ marginTop: 16, opacity: lastScrolledId ? 1 : 0 }}>{`Scrolled to Item ${lastScrolledId}`}</div>
      </div>
    </div>
  );
};

<!--- Component documentation -->

# VirtualizedList

- [Overview](#overview)
- [Props](#props)
- [Usage](#usage)
- [Feedback](#feedback)

## Overview

VirtualizedList is a component which only renders visible list items, it is a logic component and doesn't change and look and feel

Under the hood we are using - [react-window](https://github.com/bvaughn/react-window) and [react-virtualized-auto-sizer](https://github.com/bvaughn/react-virtualized-auto-sizer)

<Canvas>
  <Story
    name="Overview"
    args={{
      itemsCount: 1000
    }}
  >
    {virtualizedListTemplate.bind({})}
  </Story>
</Canvas>

## Props

<ArgsTable of={VirtualizedList} />

## Usage

<UsageGuidelines guidelines={["Use this when you expect to have many items in your list"]} />
